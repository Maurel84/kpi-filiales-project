-- Import BUDGET 2026 (PDF) into budgets table.
ALTER TABLE budgets
  ADD COLUMN IF NOT EXISTS produit text,
  ADD COLUMN IF NOT EXISTS plan_compte text,
  ADD COLUMN IF NOT EXISTS constructeur text,
  ADD COLUMN IF NOT EXISTS territoire text,
  ADD COLUMN IF NOT EXISTS budget_jan numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_fev numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_mar numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_avr numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_mai numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_jui numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_juil numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_aou numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_sep numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_oct numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_nov numeric(15,2),
  ADD COLUMN IF NOT EXISTS budget_dec numeric(15,2),
  ADD COLUMN IF NOT EXISTS cumul_fin_dec numeric(15,2),
  ADD COLUMN IF NOT EXISTS plan_n1 numeric(15,2),
  ADD COLUMN IF NOT EXISTS plan_n2 numeric(15,2);

INSERT INTO filiales (code, nom, pays, actif)
VALUES
  ('CAMEROUN', 'Cameroun', 'Cameroun', true),
  ('CONGO', 'Congo', 'Congo', true),
  ('GABON', 'Gabon', 'Gabon', true),
  ('MAROC', 'Maroc', 'Maroc', true),
  ('OFFSHORE_EXPORT', 'Offshore (EXPORT)', 'Offshore', true),
  ('RDC', 'RDC', 'RDC', true),
  ('RWANDA', 'Rwanda', 'Rwanda', true),
  ('TCHAD', 'Tchad', 'Tchad', true),
  ('TOTAL_TERRITOIRE', 'Total Territoire', 'TOTAL', true)
ON CONFLICT (code) DO NOTHING;

WITH budget_source AS (
  SELECT * FROM (VALUES
    
    ('CAMEROUN', 'Lift trucks', 'Chiffre d''affaires', 'KALMAR', 'Cameroun', 0, 572, 0, 0, 816, 0, 0, 816, 0, 244, 572, 0, 3018, 3590, 3918),
    ('CAMEROUN', 'Lift trucks', 'Quantités facturées', 'KALMAR', 'Cameroun', 0, 1, 0, 0, 2, 0, 0, 2, 0, 1, 1, 0, 7, 0, 0),
    ('CAMEROUN', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Cameroun', 345, 321, 558, 393, 363, 278, 130, 155, 355, 342, 304, 341, 3887, 8359, 9256),
    ('CAMEROUN', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Cameroun', 2, 4, 5, 3, 3, 4, 0, 1, 6, 3, 2, 6, 39, 29, 28),
    ('CAMEROUN', 'Agricole', 'Chiffre d''affaires', 'MASSEY FERGUSON', 'Cameroun', 0, 329, 33, 33, 92, 33, 0, 33, 0, 33, 33, 92, 710, 611, 768),
    ('CAMEROUN', 'Agricole', 'Quantités facturées', 'MASSEY FERGUSON', 'Cameroun', 0, 4, 1, 1, 2, 1, 0, 1, 0, 1, 1, 2, 14, 17, 21),
    ('CAMEROUN', 'Agricole', 'Chiffre d''affaires', 'NARDI', 'Cameroun', 37, 37, 55, 37, 37, 55, 37, 55, 55, 55, 37, 55, 549, 213, 243),
    ('CAMEROUN', 'Agricole', 'Quantités facturées', 'NARDI', 'Cameroun', 2, 2, 3, 2, 2, 3, 2, 3, 3, 3, 2, 3, 30, 35, 40),
    ('CONGO', 'Lift trucks', 'Chiffre d''affaires', 'KALMAR', 'Congo', 192, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 192, 384, 384, 959),
    ('CONGO', 'Lift trucks', 'Quantités facturées', 'KALMAR', 'Congo', 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 5),
    ('CONGO', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Congo', 32, 165, 142, 34, 55, 34, 34, 87, 32, 71, 130, 32, 850, 1411, 1265),
    ('CONGO', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Congo', 1, 2, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 15, 17, 16),
    ('CONGO', 'Agricole', 'Chiffre d''affaires', 'MASSEY FERGUSON', 'Congo', 101, 101, 101, 175, 101, 175, 101, 175, 175, 101, 175, 101, 1579, 2155, 2656),
    ('CONGO', 'Agricole', 'Quantités facturées', 'MASSEY FERGUSON', 'Congo', 2, 2, 2, 3, 2, 3, 2, 3, 3, 2, 3, 2, 29, 42, 55),
    ('CONGO', 'Agricole', 'Chiffre d''affaires', 'NARDI', 'Congo', 46, 94, 61, 98, 87, 71, 76, 71, 74, 48, 122, 132, 980, 585, 265),
    ('CONGO', 'Agricole', 'Quantités facturées', 'NARDI', 'Congo', 6, 10, 8, 11, 11, 10, 10, 10, 10, 7, 11, 12, 116, 136, 166),
    ('GABON', 'Lift trucks', 'Chiffre d''affaires', 'KALMAR', 'Gabon', 212, 0, 0, 0, 0, 425, 522, 522, 212, 212, 212, 212, 2531, 2841, 3576),
    ('GABON', 'Lift trucks', 'Quantités facturées', 'KALMAR', 'Gabon', 1, 0, 0, 0, 0, 2, 1, 1, 1, 1, 1, 1, 9, 9, 11),
    ('GABON', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Gabon', 118, 400, 396, 480, 298, 162, 287, 30, 164, 445, 243, 314, 3337, 3745, 4051),
    ('GABON', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Gabon', 4, 4, 6, 7, 3, 3, 4, 1, 3, 5, 4, 3, 47, 50, 57),
    ('GABON', 'Agricole', 'Chiffre d''affaires', 'MASSEY FERGUSON', 'Gabon', 0, 0, 0, 0, 129, 0, 0, 0, 0, 0, 55, 87, 271, 272, 305),
    ('GABON', 'Agricole', 'Quantités facturées', 'MASSEY FERGUSON', 'Gabon', 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 1, 2, 7, 7, 8),
    ('MAROC', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Maroc', 120, 149, 169, 106, 83, 119, 126, 138, 293, 281, 267, 258, 2107, 2215, 2343),
    ('MAROC', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Maroc', 3, 5, 2, 4, 1, 4, 2, 5, 8, 10, 7, 8, 59, 63, 64),
    ('OFFSHORE_EXPORT', 'Lift trucks', 'Chiffre d''affaires', 'KALMAR', 'Offshore (EXPORT)', 0, 0, 0, 154, 220, 220, 505, 220, 220, 220, 220, 220, 2195, 2261, 2329),
    ('OFFSHORE_EXPORT', 'Lift trucks', 'Quantités facturées', 'KALMAR', 'Offshore (EXPORT)', 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 9, 9, 10),
    ('OFFSHORE_EXPORT', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Offshore (EXPORT)', 82, 91, 21, 151, 84, 103, 193, 136, 21, 274, 95, 103, 1354, 1395, 1397),
    ('TOTAL_TERRITOIRE', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Total Territoire', 302, 361, 352, 334, 318, 263, 363, 312, 352, 491, 430, 327, 4205, 5184, 5546),
    ('TOTAL_TERRITOIRE', 'Lift trucks', 'Marge Brute', 'KALMAR', 'Total Territoire', 68, 95, 68, 44, 165, 97, 144, 257, 76, 159, 153, 118, 1442, 1557, 1788),
    ('TOTAL_TERRITOIRE', 'Lift trucks', 'Marge Brute', 'MASSEY FERGUSON', 'Total Territoire', 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 21, 113, 104, 87),
    ('CAMEROUN', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Cameroun', 102, 60, 89, 65, 81, 62, 40, 37, 46, 67, 84, 58, 792, 1367, 1493),
    ('CAMEROUN', 'Lift trucks', 'Marge Brute', 'KALMAR', 'Cameroun', 2, 79, 2, 2, 112, 2, 2, 112, 2, 35, 79, -4, 426, 509, 553),
    ('CAMEROUN', 'Lift trucks', 'Marge Brute', 'MASSEY FERGUSON', 'Cameroun', 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 13, 23, 11, -8),
    ('CONGO', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Congo', 6, 26, 22, 6, 10, 6, 6, 14, 6, 12, 21, 6, 142, 227, 205),
    ('CONGO', 'Lift trucks', 'Marge Brute', 'KALMAR', 'Congo', 29, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 29, 60, 60, 147),
    ('CONGO', 'Lift trucks', 'Marge Brute', 'MASSEY FERGUSON', 'Congo', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1),
    ('GABON', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Gabon', 30, 63, 63, 73, 51, 35, 50, 19, 35, 69, 45, 53, 586, 640, 682),
    ('GABON', 'Lift trucks', 'Marge Brute', 'KALMAR', 'Gabon', 24, 3, 3, 3, 3, 45, 45, 45, 24, 24, 24, 24, 265, 287, 351),
    ('GABON', 'Lift trucks', 'Marge Brute', 'MASSEY FERGUSON', 'Gabon', 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 15, 16, 16),
    ('MAROC', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Maroc', 69, 74, 77, 73, 69, 74, 75, 77, 100, 98, 96, 95, 978, 942, 974),
    ('MAROC', 'Lift trucks', 'Marge Brute', 'KALMAR', 'Maroc', 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 49, 50, 52),
    ('MAROC', 'Lift trucks', 'Marge Brute', 'MASSEY FERGUSON', 'Maroc', 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 23, 23, 24),
    ('TCHAD', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Tchad', 1, 1, 2, 8, 2, 2, 2, 2, 2, 20, 8, 2, 48, 48, 55),
    ('TCHAD', 'Lift trucks', 'Marge Brute', 'KALMAR', 'Tchad', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2),
    ('TCHAD', 'Lift trucks', 'Marge Brute', 'MASSEY FERGUSON', 'Tchad', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1),
    ('RWANDA', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Rwanda', 5, 4, 4, 5, 8, 4, 5, 10, 4, 9, 4, 4, 66, 91, 120),
    ('RDC', 'Lift trucks', 'Marge Brute', 'MANITOU', 'RDC', 76, 118, 91, 79, 84, 63, 153, 130, 155, 169, 156, 91, 1366, 1637, 1782),
    ('RDC', 'Lift trucks', 'Marge Brute', 'KALMAR', 'RDC', 9, 9, 59, 9, 9, 9, 9, 59, 9, 59, 9, 28, 276, 273, 296),
    ('RDC', 'Lift trucks', 'Marge Brute', 'MASSEY FERGUSON', 'RDC', 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 50, 51, 53),
    ('OFFSHORE_EXPORT', 'Lift trucks', 'Marge Brute', 'MANITOU', 'Offshore (EXPORT)', 14, 15, 4, 25, 14, 17, 32, 23, 4, 46, 16, 17, 226, 232, 233),
    ('OFFSHORE_EXPORT', 'Lift trucks', 'Marge Brute', 'KALMAR', 'Offshore (EXPORT)', 0, 0, 0, 26, 37, 37, 84, 37, 37, 37, 37, 37, 365, 376, 387),
    ('TOTAL_TERRITOIRE', 'Agricole', 'Marge Brute', 'MASSEY FERGUSON', 'Total Territoire', 20, 70, 57, 73, 80, 65, 54, 100, 115, 54, 96, 168, 951, 1181, 1460),
    ('TOTAL_TERRITOIRE', 'Agricole', 'Marge Brute', 'NARDI', 'Total Territoire', -16, -6, -2, 6, 0, 2, 10, 0, 0, 2, 2, 13, 11, 316, 190),
    ('CAMEROUN', 'Agricole', 'Marge Brute', 'MASSEY FERGUSON', 'Cameroun', 0, 39, 4, 4, 11, 4, -10, 4, 0, -6, 4, 12, 66, 97, 117),
    ('CAMEROUN', 'Agricole', 'Marge Brute', 'NARDI', 'Cameroun', -28, -28, -26, -28, -28, -26, -18, -26, -26, -16, -28, -26, -306, 34, 37),
    ('CONGO', 'Agricole', 'Marge Brute', 'MASSEY FERGUSON', 'Congo', 20, 20, 20, 35, 20, 35, 20, 35, 35, 20, 35, 20, 316, 431, 531),
    ('CONGO', 'Agricole', 'Marge Brute', 'NARDI', 'Congo', 9, 19, 12, 20, 17, 14, 15, 14, 15, 10, 24, 26, 196, 117, 53),
    ('GABON', 'Agricole', 'Marge Brute', 'MASSEY FERGUSON', 'Gabon', 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 7, 10, 33, 33, 37),
    ('RWANDA', 'Agricole', 'Marge Brute', 'MASSEY FERGUSON', 'Rwanda', 0, 6, 0, 0, 4, 0, 0, 4, 0, 4, 0, 8, 26, 64, 109),
    ('RDC', 'Agricole', 'Marge Brute', 'MASSEY FERGUSON', 'RDC', 0, 4, 33, 15, 30, 7, 21, 57, 61, 5, 31, 87, 349, 389, 495),
    ('RDC', 'Agricole', 'Marge Brute', 'NARDI', 'RDC', 3, 3, 12, 12, 10, 10, 10, 12, 8, 6, 6, 10, 103, 147, 81),
    ('OFFSHORE_EXPORT', 'Agricole', 'Marge Brute', 'MASSEY FERGUSON', 'Offshore (EXPORT)', 0, 0, 0, 19, 0, 19, 23, 0, 19, 31, 19, 31, 162, 167, 172),
    ('OFFSHORE_EXPORT', 'Agricole', 'Marge Brute', 'NARDI', 'Offshore (EXPORT)', 0, 0, 0, 3, 0, 3, 3, 0, 3, 3, 0, 3, 18, 18, 19),
    ('OFFSHORE_EXPORT', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Offshore (EXPORT)', 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 13, 13, 14),
    ('OFFSHORE_EXPORT', 'Agricole', 'Quantités facturées', 'MANITOU', 'Offshore (EXPORT)', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
    ('OFFSHORE_EXPORT', 'Agricole', 'Chiffre d''affaires', 'MASSEY FERGUSON', 'Offshore (EXPORT)', 0, 0, 0, 115, 0, 115, 134, 0, 115, 188, 115, 188, 970, 999, 1029),
    ('OFFSHORE_EXPORT', 'Agricole', 'Quantités facturées', 'MASSEY FERGUSON', 'Offshore (EXPORT)', 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 7, 7, 8),
    ('OFFSHORE_EXPORT', 'Agricole', 'Chiffre d''affaires', 'NARDI', 'Offshore (EXPORT)', 0, 0, 0, 18, 0, 18, 18, 0, 18, 18, 0, 18, 107, 110, 113),
    ('OFFSHORE_EXPORT', 'Agricole', 'Quantités facturées', 'NARDI', 'Offshore (EXPORT)', 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 6, 6, 7),
    ('RDC', 'Lift trucks', 'Chiffre d''affaires', 'KALMAR', 'RDC', 0, 0, 537, 0, 0, 0, 0, 537, 0, 537, 0, 211, 1822, 1822, 2033),
    ('RDC', 'Lift trucks', 'Quantités facturées', 'KALMAR', 'RDC', 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 4, 4, 5),
    ('RDC', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'RDC', 262, 637, 402, 324, 360, 159, 945, 740, 962, 1093, 967, 391, 7243, 9502, 10639),
    ('RDC', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'RDC', 2, 6, 4, 3, 6, 5, 6, 6, 6, 7, 5, 4, 60, 86, 95),
    ('RDC', 'Agricole', 'Chiffre d''affaires', 'MASSEY FERGUSON', 'RDC', 0, 30, 232, 104, 213, 48, 146, 407, 431, 35, 224, 616, 2485, 2773, 3522),
    ('RDC', 'Agricole', 'Quantités facturées', 'MASSEY FERGUSON', 'RDC', 0, 1, 4, 2, 4, 1, 4, 5, 6, 1, 3, 4, 35, 43, 56),
    ('RDC', 'Agricole', 'Chiffre d''affaires', 'NARDI', 'RDC', 23, 23, 87, 76, 64, 64, 62, 76, 51, 37, 37, 62, 662, 929, 581),
    ('RDC', 'Agricole', 'Quantités facturées', 'NARDI', 'RDC', 2, 2, 7, 6, 5, 5, 5, 6, 4, 3, 3, 5, 53, 74, 50),
    ('RWANDA', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Rwanda', 32, 27, 37, 32, 53, 28, 33, 74, 39, 62, 29, 29, 473, 647, 846),
    ('RWANDA', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Rwanda', 1, 1, 1, 1, 2, 1, 1, 2, 1, 2, 1, 1, 15, 18, 22),
    ('RWANDA', 'Agricole', 'Chiffre d''affaires', 'MASSEY FERGUSON', 'Rwanda', 0, 47, 0, 0, 25, 0, 0, 26, 0, 27, 0, 67, 192, 461, 798),
    ('RWANDA', 'Agricole', 'Quantités facturées', 'MASSEY FERGUSON', 'Rwanda', 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 5, 11, 17),
    ('TCHAD', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Tchad', 0, 0, 7, 56, 7, 7, 7, 7, 7, 156, 56, 7, 316, 249, 321),
    ('TCHAD', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Tchad', 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 1, 0, 4, 4, 10),
    ('TOTAL_TERRITOIRE', 'Lift trucks', 'Chiffre d''affaires', 'KALMAR', 'Total Territoire', 404, 572, 537, 154, 1035, 644, 1027, 2094, 432, 1213, 1004, 835, 9951, 10898, 12815),
    ('TOTAL_TERRITOIRE', 'Lift trucks', 'Quantités facturées', 'KALMAR', 'Total Territoire', 2, 1, 1, 1, 3, 3, 2, 5, 2, 4, 3, 4, 31, 24, 31),
    ('TOTAL_TERRITOIRE', 'Lift trucks', 'Chiffre d''affaires', 'MANITOU', 'Total Territoire', 991, 1790, 1732, 1575, 1302, 890, 1754, 1367, 1873, 2725, 2092, 1476, 19567, 27523, 30119),
    ('TOTAL_TERRITOIRE', 'Lift trucks', 'Quantités facturées', 'MANITOU', 'Total Territoire', 14, 23, 21, 21, 17, 19, 15, 18, 26, 31, 22, 25, 252, 280, 306),
    ('TOTAL_TERRITOIRE', 'Agricole', 'Quantités facturées', 'MANITOU', 'Total Territoire', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
    ('TOTAL_TERRITOIRE', 'Agricole', 'Chiffre d''affaires', 'MASSEY FERGUSON', 'Total Territoire', 101, 506, 365, 426, 561, 370, 381, 640, 721, 384, 601, 1151, 6207, 7271, 9079),
    ('TOTAL_TERRITOIRE', 'Agricole', 'Quantités facturées', 'MASSEY FERGUSON', 'Total Territoire', 2, 8, 7, 7, 13, 6, 7, 10, 10, 6, 9, 12, 97, 127, 165),
    ('TOTAL_TERRITOIRE', 'Agricole', 'Chiffre d''affaires', 'NARDI', 'Total Territoire', 106, 153, 203, 228, 188, 208, 192, 202, 197, 158, 195, 267, 2298, 1837, 1204),
    ('TOTAL_TERRITOIRE', 'Agricole', 'Quantités facturées', 'NARDI', 'Total Territoire', 10, 14, 18, 20, 18, 19, 18, 19, 18, 14, 16, 21, 205, 251, 263)
  ) AS v(
    filiale_code,
    produit,
    plan_compte,
    constructeur,
    territoire,
    budget_jan,
    budget_fev,
    budget_mar,
    budget_avr,
    budget_mai,
    budget_jui,
    budget_juil,
    budget_aou,
    budget_sep,
    budget_oct,
    budget_nov,
    budget_dec,
    cumul_fin_dec,
    plan_n1,
    plan_n2
  )
)
INSERT INTO budgets (
  filiale_id,
  annee,
  produit,
  plan_compte,
  constructeur,
  territoire,
  budget_jan,
  budget_fev,
  budget_mar,
  budget_avr,
  budget_mai,
  budget_jui,
  budget_juil,
  budget_aou,
  budget_sep,
  budget_oct,
  budget_nov,
  budget_dec,
  cumul_fin_dec,
  plan_n1,
  plan_n2
)
SELECT
  f.id,
  2025,
  v.produit,
  v.plan_compte,
  v.constructeur,
  v.territoire,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_jan * 1000 ELSE v.budget_jan END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_fev * 1000 ELSE v.budget_fev END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_mar * 1000 ELSE v.budget_mar END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_avr * 1000 ELSE v.budget_avr END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_mai * 1000 ELSE v.budget_mai END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_jui * 1000 ELSE v.budget_jui END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_juil * 1000 ELSE v.budget_juil END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_aou * 1000 ELSE v.budget_aou END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_sep * 1000 ELSE v.budget_sep END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_oct * 1000 ELSE v.budget_oct END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_nov * 1000 ELSE v.budget_nov END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.budget_dec * 1000 ELSE v.budget_dec END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.cumul_fin_dec * 1000 ELSE v.cumul_fin_dec END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.plan_n1 * 1000 ELSE v.plan_n1 END,
  CASE WHEN v.plan_compte IN ('Chiffre d''affaires', 'Marge Brute') THEN v.plan_n2 * 1000 ELSE v.plan_n2 END
FROM budget_source v
JOIN filiales f ON f.code = v.filiale_code;
